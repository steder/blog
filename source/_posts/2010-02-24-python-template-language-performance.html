---
layout: post
title: "Python template language performance (Chameleon is cool!)"
date: 2010-02-24
comments: false
---

<div class='post'>
I really like the Genshi templating library.  However, it really doesn't perform nearly as well as something like ClearSilver.  Out of curiosity I updated the benchmarks included with Genshi to include the chameleon.genshi package.  It performs amazingly well.<br /><br />Genshi tag builder                            378.72 ms<br />Genshi template                               213.89 ms<br />Genshi text template                          146.23 ms<br />Genshi template + tag builder                 404.52 ms<br />ClearSilver                                    65.23 ms<br />Django template                               423.26 ms<br />Chameleon Genshi Template                      26.02 ms<br /><br />These numbers are from the genshi bigtable benchmark which generates<br />a 1000x10 table (1000 rows of 10 numbers each).  The load and creation <br />of the template and the construction of the list of dicts that make<br />up the 1000 rows of data are all done outside of the timing.  All this <br />benchmark tests is the time to pump this data into the template and render.<br /><br />I'm still suprised by the fact that chameleon beats clearsilver here.<br /><br />Ah.  The ClearSilver benchmark looks something like:<br /><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_clearsilver</span><span class="p">():</span><br />    <span class="sd">&quot;&quot;&quot;ClearSilver&quot;&quot;&quot;</span><br />    <span class="n">hdf</span> <span class="o">=</span> <span class="n">neo_util</span><span class="o">.</span><span class="n">HDF</span><span class="p">()</span><br />    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">):</span><br />        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span><br />            <span class="n">hdf</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&quot;rows.</span><span class="si">%d</span><span class="s">.cell.</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span><br />    <span class="n">cs</span> <span class="o">=</span> <span class="n">neo_cs</span><span class="o">.</span><span class="n">CS</span><span class="p">(</span><span class="n">hdf</span><span class="p">)</span><br />    <span class="n">cs</span><span class="o">.</span><span class="n">parseStr</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><br /><span class="s">        &lt;table&gt;&lt;?cs each:row=rows ?&gt;</span><br /><span class="s">&lt;tr&gt;&lt;?cs each:c=row.cell ?&gt;&lt;td&gt;&lt;?cs var:c ?&gt;&lt;/td&gt;&lt;?cs /each ?&gt;&lt;/tr&gt;</span><br /><span class="s">&lt;?cs /each?&gt;&lt;/table&gt;</span><br /><span class="s">&quot;&quot;&quot;</span><span class="p">)</span><br />    <span class="n">cs</span><span class="o">.</span><span class="n">render</span><span class="p">()</span><br /></pre></div><br />So now I understand why the clearsilver test is taking so long.  That benchmark code transforms<br />the list of dicts into an HDF dataset and does some string escapes and so on.  It's easy to<br />confirm that this transformation is the majority of the runtime of the ClearSilver benchmark.<br /><br />Moving that construction of the HDF dataset outside of the timed benchmark function shows us that the majority of the time ClearSilver spends is not rendering your content but building an HDF dataset.<br /><br />ClearSilver                                     3.41 ms<br />Chameleon Genshi Template                      26.70 ms<br /><br />However, it is still very impressive that chameleon runs as fast as it does given that it is able to work with the unmodified python data structure rather then an optimized HDF dataset.  And honestly in our system I don't think we can move the construction of the HDF out of the rendering pipeline so that ~60ms rendering time with ClearSilver is actually going to be slower then Chameleon.  Combine the speed of Chameleon with Genshi's syntax and you've got a pretty sweet templating system.  <br /><br />Of course, Chameleon's default template language (TAL) has many of the same aspects I like about Genshi.  <br /><br />So let's get a number for TAL too:<br /><br />ClearSilver                                    65.60 ms<br />chameleon.genshi                               25.77 ms<br />chameleon (TAL)                                26.25 ms</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Mike</div>
<div class='content'>
Vishal,<br /><br />You can grab the package here:<br />http://pypi.python.org/pypi/chameleon.genshi/<br /><br />And you&#39;ll also need chameleon core:<br />http://pypi.python.org/pypi/Chameleon/<br /><br />What few docs there are I found here:<br />http://chameleon.repoze.org/docs/latest/genshi.html<br /><br />They are not terribly helpful, mostly I found out everything by reading the normal chameleon docs and the official genshi docs.<br /><br />Honestly, I think you&#39;re better off just using ZPT as that is both better supported by chameleon and better documented.</div>
</div>
<div class='comment'>
<div class='author'>Vishal</div>
<div class='content'>
Hi Mike,<br /><br />Can you provide some link for docs on chameleon.genshi?<br /><br />Where can i go for this?</div>
</div>
</div>
