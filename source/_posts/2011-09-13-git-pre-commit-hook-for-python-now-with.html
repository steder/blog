---
layout: post
title: "Git Pre-commit Hook For Python now with extra Python!"
date: 2011-09-13
comments: false
categories:
 - pyflakes
 - git
 - python
---

<div class='post'>
After reading a post by&nbsp;<a href="http://scrollingtext.org/git-pre-commit-python-syntax">Bryce Verdier</a>, and&nbsp;inspired by comments that suggested the Python version of said hook script would not be as nice as the bash version I decided to hack up a quick python version of the same script using <a href="http://pypi.python.org/pypi/pyflakes">pyflakes</a> instead of <a href="http://www.logilab.org/857">pylint</a>.<br /><br /><pre class="brush: py; gutter: false;">#!/usr/bin/env python<br />#-*- mode: python -*-<br /><br />from subprocess import Popen, PIPE<br />import sys<br /><br />syntax_checker = "pyflakes"<br /><br />def run(command):<br />    p = Popen(command.split(), stdout=PIPE, stderr=PIPE)<br />    p.wait()<br />    return p.returncode, p.stdout.read().strip().split(), p.stderr.read()<br /><br />_, files_modified, _= run("git diff-index --name-only HEAD")<br /><br />for fname in files_modified:<br />    if fname.endswith(".py"):<br />        print &gt;&gt;sys.stderr, "Checking syntax on %s: ... "%(fname,),<br />        exit_code, _, errors = run("%s %s"%(syntax_checker, fname))<br />        if exit_code != 0:<br />            print &gt;&gt;sys.stderr, "\rChecking syntax on %s: FAILED! \n%s"%(fname, errors)<br />            sys.exit(exit_code)<br />        else:<br />            print &gt;&gt;sys.stderr, "\rChecking syntax on %s: OK!"%(fname,)<br /><br /></pre>You can download / fork this <a href="https://gist.github.com/1214061">here</a> if would like to give it a try: <a href="https://gist.github.com/1214061">https://gist.github.com/1214061</a>   And of course, if you're like me and you have no idea what to do with this script you can just do the following:  <br /><br /><pre class="brush: bash; gutter: false;">cp pre-commit.py YourGitProject/.git/hooks/pre-commit<br />chmod +x YourGitProject/.git/hooks/pre-commit<br /></pre><br />It's also worth noting that this version is currently really strict. &nbsp;<b>ANY</b>&nbsp;warnings will cause your commit to fail. &nbsp;Of course, replacing pyflakes with pylint again is a simple modification of the syntax_checker variable in the above script.<br /><br /><br /></div>
